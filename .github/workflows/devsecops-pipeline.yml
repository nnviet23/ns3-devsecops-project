name: DevSecOps Pipeline

on:
  push:
    branches: [ "main" ]
  pull_request:
    branches: [ "main" ]

jobs:
  security-scan:
    name: Security Vulnerability Scan
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Code
        uses: actions/checkout@v3

      # Bước 1: Cài đặt Snyk CLI vào máy ảo chạy Pipeline
      - name: Install Snyk CLI
        uses: snyk/actions/setup@master

      # Bước 2: Quét mã nguồn tĩnh (SAST) cho C++ (NS-3 code)
      # Lệnh 'snyk code test' sẽ tìm lỗi bảo mật trong file .cc của bạn
      - name: Snyk Code Test (SAST for C++)
        run: snyk code test --severity-threshold=medium
        env:
          SNYK_TOKEN: ${{ secrets.SNYK_TOKEN }}

      # Bước 3: Quét các thư viện Python (SCA) cho file .py
      - name: Run Snyk to check Python dependencies
        uses: snyk/actions/python@master
        env:
          SNYK_TOKEN: ${{ secrets.SNYK_TOKEN }}

  build-simulation:
    needs: security-scan
    runs-on: ubuntu-latest
    steps:
      - name: Verification
        run: |
          echo "Security scan completed successfully!"
          echo "Deployment ready for NS-3 simulation."
